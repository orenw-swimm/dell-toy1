inputs:

  vm_user_name:
    type: string
    hidden: false
    allow_update: false
    display_label: Deployment User
    description: |
      Name of the deployment user on the Virtual Machine.
      Cannot contain leading or trailing spaces.
    default: Administrator
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: Cannot contain leading or trailing spaces.
    display:
      group: ned
      index: 1

  vm_password_secret_name:
    type: secret_key
    hidden: false
    allow_update: false
    display_label: Virtual Machine Password Secret Name
    description: |
      Secret name containing the user password for
      the Windows Virtual Machine.
    constraints:
    - type: password
    display:
      group: ned
      index: 2

  hostname:
    type: string
    hidden: false
    allow_update: false
    display_label: Hostname
    description: |
      Hostname of the Virtual Machine
      (an auto-generated suffix will also be added).
      Cannot contain characters other than:
      letters (a-z, A-Z), numbers (0-9), or hyphens (-).
      Can be up to 63 characters long.
    constraints:
    - pattern: ^(?!-)[a-zA-Z0-9-]{1,63}(?<!-)$
      error_message: |
        Must be letters (a-z, A-Z), numbers (0-9), or hyphens (-).
        No more than 64 characters.
    - max_length: 64
    default: XMPro-SH
    display:
      group: ned
      index: 3

  binary_image_artifact_url:
    type: string
    hidden: true
    allow_update: false
    display_label: Virtual Machine Image Repository URL
    description: |
      URL of the Image Binary that will be used to create
      the Virtual Machine.
    default:
      get_secret:
      - get_input: artifact_configuration_secret_name
      - binary_image_url

  binary_image_artifact_username:
    type: string
    hidden: true
    allow_update: false
    display_label: Virtual Machine Image Repository User Name
    description: |
      User name of the Repository of the Image Binary that will be
      used to create the Virtual Machine.
    default:
      get_secret:
      - get_input: artifact_configuration_secret_name
      - binary_image_access_user

  binary_image_artifact_access_token_secret_name:
    type: list
    hidden: true
    allow_update: false
    display_label: Virtual Machine Image Repository Token Secret Name
    description: |
      Name of the secret storing the Token to the Repository of the
      Image Binary that will be used to create the Virtual Machine.
    default:
    - get_input: artifact_configuration_secret_name
    - binary_image_access_token

  binary_image_version:
    type: string
    hidden: true
    allow_update: false
    display_label: Virtual Machine Image Version
    description: |
      Virtual Machine Image Version that will be used to create
      the Virtual Machine.
    default:
      get_secret:
      - get_input: artifact_configuration_secret_name
      - binary_image_version

  os_type:
    type: string
    hidden: false
    allow_update: false
    display_label: OS Type
    description: The virtual machine Operating System.
    default: WIN2019-SERVER
    constraints:
    - valid_values:
      - WIN2019-SERVER
      - WIN2022-SERVER
      - WIN-OTHERS
    display:
      group: ned
      index: 5

  vcpus:
    type: integer
    hidden: false
    allow_update: true
    display_label: vCPUs
    description: |
      Number of virtual CPUs allocated to the Virtual Machine.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 4
    constraints:
    - greater_or_equal: 2
    display:
      group: ned
      index: 8

  memory_size:
    type: string
    hidden: false
    allow_update: true
    display_label: Memory Size
    description: |
      Memory size with unit [KB,MB,GB,TB,PB,EB,ZB,YB].
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 16GB
    constraints:
    - pattern: \d+(\.\d+)?(KB|MB|GB|TB|PB|EB|ZB|YB)
      error_message: |
        Incorrect format.
        Memory size must be followed by unit [KB,MB,GB,TB,PB,EB,ZB,YB].
        Example: 4GB
    display:
      group: ned
      index: 10

  os_disk_size:
    type: string
    hidden: false
    allow_update: true
    display_label: OS Disk Size
    description: |
      Storage size with unit [KB,MB,GB,TB,PB,EB,ZB,YB].
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 50GB
    constraints:
    - pattern: \d+(\.\d+)?(KB|MB|GB|TB|PB|EB|ZB|YB)
      error_message: |
        Incorrect format.
        Disk size must be followed by unit [KB,MB,GB,TB,PB,EB,ZB,YB].
        Example: 50GB
    display:
      group: ned
      index: 15

  disk:
    type: string
    hidden: false
    allow_update: false
    display_label: Endpoint Datastore Path
    description: |
      Deployment datastore path on target endpoint.
      Available datastores can be retrieved from the endpoint screen.
    constraints:
    - valid_values:
        jmespath:
        - extra.hw_core.storage.dataStoreOrVolumes[?((((type=='SSD'||type=='HDD')&&name.contains(@,'DataStore'))||(shared&&name=='/Shared_DataStore'))&&status=='ONLINE')].mountPath
        - get_inventory:
            get_environment_capability: ece_service_tag
    display:
      group: ned
      index: 20

  hardware_options.vTPM:
    type: boolean
    hidden: true
    allow_update: false
    display_label: Hardware Options - vTPM
    description: |
      Enable vTPM.
      Required for For Windows 11 OS, optional for other OS.
    default: false

  hardware_options.secure_boot:
    type: boolean
    hidden: true
    allow_update: false
    display_label: Hardware Options - Secure Boot
    description: |
      Enable secure boot.
      Required for For Windows 11 OS, optional for other OS.
    default: false

  hardware_options.firmware_type:
    type: string
    hidden: true
    allow_update: false
    display_label: Hardware Options - Firmware Type
    description: |
      The firmware type configured in the Virtual Machine.
      For Windows 11 OS this must be UEFI.
    default: BIOS
    constraints:
    - valid_values:
      - BIOS
      - UEFI

  enable_management:
    type: boolean
    hidden: true
    allow_update: false
    display_label: Enable Management
    description: |
      Enable management which will create a tap interface for
      the infrastructure segment.
    default: true

  segment_name:
    type: string
    hidden: false
    allow_update: true
    display_label: Bridged Network Name
    description: Name of the Bridged Network.
    constraints:
    - valid_values:
        jmespath:
        - extra.hw_core.network.virtualSegment[?type=='BRIDGE'].name
        - get_inventory:
            get_environment_capability: ece_service_tag
    display:
      group: ned
      index: 25

  dhcp:
    type: boolean
    hidden: false
    allow_update: false
    display_label: DHCP
    description: |
      Enable to allow IP configuration to be taken from DHCP
      instead of static IP settings.
    default: true
    display:
      group: ned
      index: 30

  dns:
    type: list
    item_type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: DNS Servers
    description: List of DNS servers addresses.
    required: true
    default: []
    display:
      group: ned
      index: 35

  gateway:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Gateway IP Address
    description: IP Address of the Network Gateway.
    required: true
    constraints:
    - pattern: ^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$|^$
      error_message: |
        Invalid format for IP Address.
        Example: 172.16.0.1
    display:
      group: ned
      index: 40

  static_ip:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Static IP and Mask Suffix
    description: |
      IP address and suffix. Example: 172.16.0.1/16.
      Only required for static IP deployments, not for DHCP.
    required: true
    display:
      group: ned
      index: 45
    constraints:
    - pattern: ^(?:((25[0-5]|2[0-4]\d|1\d\d|\d{1,2})(\.(25[0-5]|2[0-4]\d|1\d\d|\d{1,2})){3})\/(3[0-2]|[12]?\d)|)$
      error_message: |
        Invalid format for IP Address in CIDR format.
        Example: 172.16.0.1/16

  network_settings:
    type: list
    item_type: dell.types.nativeedge.VMDeployNetworkSettings
    hidden: true
    allow_update: true
    display_label: Network Settings
    description: List of VMDeployNetworkSettings.
    default:
    - name: VNIC1
      segment_name:
        get_input: segment_name

  usb:
    type: list
    item_type: string
    hidden: true
    allow_update: false
    display_label: USB Devices List
    description: |
      A list of USB logical names to pass through to the Virtual Machine.
      Valid values are "USB-1" to "USB-10"
      Please make sure to select the USB port where USB device is connected.
    required: false
    constraints:
    - valid_values:
        jmespath:
        - extra.hw_core.usbDevice[*].logicalName
        - get_inventory:
            get_environment_capability: ece_service_tag

  serial_port:
    type: list
    item_type: string
    hidden: true
    allow_update: false
    display_label: Serial Port
    description: |
      Serial port passthrough.
      Please make sure to select the port where required device is connected.
      Example:
        - {"port": "COM-1"}
        - {"port": "COM-2"}
    required: false
    constraints:
    - valid_values:
        jmespath:
        - '[extra.hw_core.serialPorts[*].{"port":logicalName,"mode":`RS-232`}[*].values(@).join(`_`,@)[],extra.hw_core.serialPorts[*].{"port":logicalName,"mode":`RS-422`}[*].values(@).join(`_`,@)[],extra.hw_core.serialPorts[*].{"port":logicalName,"mode":`RS-485`}[*].values(@).join(`_`,@)[]][]'
        - get_inventory:
            get_environment_capability: ece_service_tag

  gpu_passthrough:
    type: list
    item_type: string
    hidden: true
    allow_update: false
    display_label: GPU Passthrough
    description: |
      A list of GPU logical names.
      Please make sure to select the GPU that is currently available in your
      Endpoint. A list of GPU logical names available for your endpoint can
      be found in the NativeEdge UI under Endpoints / Hardware / Peripherals
    required: false
    constraints:
    - valid_values:
        jmespath:
        - extra.hw_core.pciDevice[?deviceType=='GPU'].logicalName
        - get_inventory:
            get_environment_capability: ece_service_tag

  video:
    type: list
    item_type: string
    hidden: true
    allow_update: false
    display_label: Video Passthrough
    description: |
      Video passthrough. A list of Video logical names (string).
      E.g. ['onboarded-controller']
    required: false
    constraints:
    - valid_values:
        jmespath:
        - extra.hw_core.video[*].logicalName
        - get_inventory:
            get_environment_capability: ece_service_tag

  cloudinit:
    type: string
    hidden: true
    allow_update: false
    display_label: Cloud Init Config
    description: |
      Cloud init cloud config, can be obtained with
      dell.nodes.CloudInit.CloudConfig
    required: false
    default: ''

  iso_files:
    type: list
    item_type: string
    hidden: true
    allow_update: false
    display_label: ISO Files
    description: |
      List ISO files (references to catalog) to be downloaded before
      Virtual Machine provisioning.
    default: []
    required: false
