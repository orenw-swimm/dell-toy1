inputs:

  sm_hostname:
    type: string
    hidden: true
    allow_update: false
    display_label: Subscription Manager Hostname
    description: |
      Hostname of the Virtual Machine
      (an auto-generated suffix will also be added).
      Cannot contain characters other than:
      letters (a-z, A-Z), numbers (0-9), or hyphens (-).
      Can be up to 63 characters long.
    default:
      concat:
      - get_input: hostname_prefix
      - SM

  sm_vm_user_name:
    type: string
    hidden: true
    allow_update: false
    display_label: Subscription Manager Deployment User
    description: |
      Name of deployment user in the Virtual Machine template in vSphere.
      Cannot contain leading or trailing spaces.
    default:
      get_input: vm_user_name

  sm_vm_password_secret_name:
    type: secret_key
    hidden: false
    allow_update: false
    display_label: Subscription Manager Virtual Machine Password Secret Name
    description: |
      Secret name containing the user password for
      the Windows Virtual Machine.
    constraints:
    - type: password
    display:
      group: vsphere_sm
      index: 200

  sm_allowed_esxi_host:
    type: list
    item_type: string
    hidden: false
    allow_update: false
    display_label: Subscription Manager ESXi Hostnames
    description: |
      Names of the ESXi hosts on which the Virtual Machine should be placed.
      Mandatory for USB passthrough.
      Example: [node--01.example.local, node--02.example.local]
    display:
      group: vsphere_sm
      index: 205
    required: false
    default: []

  sm_vcpus:
    type: integer
    hidden: false
    allow_update: true
    display_label: Subscription Manager vCPUs
    description: |
      Number of virtual CPUs allocated to the Virtual Machine.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 2
    constraints:
    - greater_or_equal: 2
    display:
      group: vsphere_sm
      index: 210

  sm_memory_size:
    type: integer
    hidden: false
    allow_update: true
    display_label: Subscription Manager Memory Size
    description: |
      Memory (in MB) allocated to the Virtual Machine.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 8192
    constraints:
    - greater_or_equal: 8192
    display:
      group: vsphere_sm
      index: 215

  sm_os_disk_size:
    type: integer
    hidden: false
    allow_update: true
    display_label: Subscription Manager OS Disk Size
    description: |
      Main OS disk size in GB.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 40
    constraints:
    - greater_or_equal: 30
    display:
      group: vsphere_sm
      index: 220

  sm_network_mappings:
    type: dell.datatypes.vsphere.NetworkMappings
    hidden: true
    allow_update: false
    display_label: Subscription Manager Network Mappings
    description: |
      Array of key-value details for the OVF network setup.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: true
    display:
      group: network
      index: 7
    default:
      dns_servers:
        get_input: dns
      connect_networks:
      - name:
          get_input:
          - network
          - name
        switch_distributed:
          get_input:
          - network
          - switch_distributed
        management:
          get_input:
          - network
          - management
        external:
          get_input:
          - network
          - external
        use_dhcp:
          get_input: dhcp
        network:
          get_input: cidr
        gateway:
          get_input: gateway
        ip:
          get_input: sm_static_ip

  sm_static_ip:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Subscription Manager Static IP
    description: |
      IP address. Example: 172.16.0.1.
      Only required for static IP deployments, not for DHCP.
    required: true
    display:
      group: vsphere_sm
      index: 225
    constraints:
    - pattern: ^(?:((25[0-5]|2[0-4]\d|1\d\d|\d{1,2})(\.(25[0-5]|2[0-4]\d|1\d\d|\d{1,2})){3}))$
      error_message: |
        Invalid format for IP Address.
        Example: 172.16.0.1

  sm_pci_devices:
    type: list
    item_type: dell.datatypes.vsphere.PCIDevice
    hidden: true
    allow_update: false
    display_label: Subscription Manager PCI Devices
    description: |
      List of PCI Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  sm_usb_devices:
    type: list
    item_type: dell.datatypes.vsphere.USBDevice
    hidden: true
    allow_update: false
    display_label: Subscription Manager USB Devices
    description: |
      List of USB Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  sm_serial_ports:
    type: list
    item_type: dell.datatypes.vsphere.SerialPort
    hidden: true
    allow_update: false
    display_label: Subscription Manager Serial Ports
    description: |
      A list of serial ports to pass through to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  sm_nics_device_list:
    type: list
    item_type: dell.datatypes.vsphere.NIC
    hidden: true
    allow_update: false
    display_label: Subscription Manager NICs Devices
    description: |
      List of NIC Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    default: []

data_types:

  dell.datatypes.vsphere.USBDevice:
    properties:
      device_name:
        type: string
        description: Host USB Device Name
        required: true
      controller_type:
        type: string
        description: |
          USB Controller type associated with USB.
          Values can be: usb2, usb3
        required: false
        default: usb3

  dell.datatypes.vsphere.SerialPort:
    properties:
      device_name:
        type: string
        description: |
          Host Serial Port Name.
          Should be an absolute path: /dev/char/serial/uartX
        required: true

  dell.datatypes.vsphere.PCIDevice:
    properties:
      device_name:
        type: string
        description: PCI Passthrough Device Name
        required: true

  dell.datatypes.vsphere.NIC:
    properties:
      network_name:
        type: string
        description: |
          Name of the network to be connected.
      external_network_distributed:
        type: boolean
        description: |
          Determines if this is connected to a distributed port group.
        default: false
      adapter_type:
        type: string
        description: |
          Type of the adapter. Possible values: Vmxnet3, Vmxnet2, Sriov, E1000, E1000e
        default: Vmxnet3
      network_management:
        type: boolean
        description: |
          Determines if this is a management network.
        default: true
      external_network:
        type: boolean
        description: |
          Determines if this is an external network.
        default: true
      dhcp_network:
        type: boolean
        description: |
          Determines if IP address should be fetched from DHCP server.
        default: false
      network_cidr:
        type: string
        description: |
          Address of the network in CIDR format e.g. 192.168.0.1/24
        default: ''
        required: false
      gateway:
        type: string
        description: |
          IP address of the default gateway.
        required: false
      ip:
        type: string
        description: |
          Static IP address to be set for this network interface.
        required: false

  dell.datatypes.vsphere.NetworkMappings:
    properties:
      domain:
        type: string
        description: |
          Name of the domain.
        required: false
      dns_servers:
        type: list
        description: |
          List of DNS servers.
        required: false
      connect_networks:
        type: list
        description: |
          List of networks to be connected.
        required: false

  dell.datatypes.vsphere.ConnectNetwork:
    properties:
      name:
        type: string
        description: |
          Name of the network to be connected.
      switch_distributed:
        type: boolean
        description: |
          Determines if this is connected to a distributed port group.
        default: false
      management:
        type: boolean
        description: |
          Determines if this is a management network.
        default: false
      external:
        type: boolean
        description: |
          Determines if this is an external network.
        default: false
      nsx_t_switch:
        type: boolean
        description: |
          Determines if this is connected to a NSX-T Logical Switch.
        default: false
      use_dhcp:
        type: boolean
        description: |
          Determines if IP address should be fetched from DHCP server.
        default: true
      network:
        type: string
        description: |
          Address of the network in CIDR format e.g. 192.168.0.1/24
        default: ''
        required: false
      gateway:
        type: string
        description: |
          IP address of the default gateway.
        required: false
      ip:
        type: string
        description: |
          Static IP address to be set for this network interface.
        required: false
