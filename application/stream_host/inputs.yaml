dsl_definitions:

  onprem_windows_services_zip_filename: &onprem_windows_services_zip_filename
    onprem-windows-services.zip

  stream_host_service_filename: &stream_host_service_filename
    StreamHost-win10-x64-v4.3.7.exe

  stream_host_installer_url: &stream_host_installer_url
    concat:
      - { get_attribute: [validate_secrets, installer_url] }
      - *stream_host_service_filename
      - { get_input: artifact_base_url_parameters }

  ms_dotnet_core_hosting_bundle_filename: &ms_dotnet_core_hosting_bundle_filename
    dotnet-hosting-6.0.25-win.exe

  ms_dotnet_core_hosting_bundle_url: &ms_dotnet_core_hosting_bundle_url
    internet_connected:
      https://download.visualstudio.microsoft.com/download/pr/1fd87564-6bdb-4123-90dd-26488ec868c9/6c68988c310805bdcbb07b704fbe3e9d/dotnet-hosting-6.0.25-win.exe
    airgapped:
      concat:
        - { get_attribute: [validate_secrets, installer_url] }
        - *ms_dotnet_core_hosting_bundle_filename
        - { get_input: artifact_base_url_parameters }

  sh_msi_exec_file: &sh_msi_exec_file
    XMIoT.Gateway.Host.Console.Setup.msi

inputs:

  stream_host_installer_url:
    type: string
    hidden: true
    display_label: XMPro Stream Host Installer URL
    description: XMPro Stream Host Installer URL
    default: *stream_host_installer_url

  stream_host_service_filename:
    type: string
    hidden: true
    display_label: XMPro Stream Host Executable File Name
    description: XMPro Stream Host Executable File Name
    default: *stream_host_service_filename

  sh_msi_exec_file:
    type: string
    hidden: true
    display_label: XMPro Stream Host Executable Msi File Name
    description: XMPro Stream Host Executable Msi File Name
    default: *sh_msi_exec_file

  stream_host_installation_dir:
    type: string
    hidden: true
    display_label: XMPro Stream Host Installation Directory
    description: >
      Directory on the newly created Windows Virtual Machine for XMPro Stream Host
      that stores the installation files.
    default:
      concat:
        - 'C:\Users\'
        - { get_input: vm_user_name }
        - '\XMPro_Stream_Host'

  xmpro_suite_deployment_id:
    type: deployment_id
    hidden: false
    allow_update: false
    display_label: XMPro Platform Suite Deployment
    description: Select deployment that represents XMPro Suite deployment.
    constraints:
      - labels:
        - solution:
            subscription_manager
    display:
      group: xmpro
      index: 1000

  stream_host_instance_number_for_default:
    type: integer
    hidden: false
    allow_update: false
    display_label: Number of Instances for Default Collection
    description: |
      The number of Stream Host instances to deploy to the Default collection.
      Can be zero if no Default instances are required and are instead
      specified in non-default collections.
    default: 1
    constraints:
      - greater_or_equal: 0
    display:
      group: xmpro
      index: 1005

  additional_instances_for_non_default_collection:
    type: list
    item_type: dell.types.XMPro.NonDefaultCollectionInstance
    hidden: false
    allow_update: false
    display_label: Instances for Non-Default Collections
    description: |
      A list of non-default collections to deploy Stream Host instances to.
      The collection IDs and associated Secrets can be retrieved from the
      XMPro Data Stream Designer.
      Example:
      [
        {
          "collection_id": "e691f7f8-XXXX-XXXX-XXXX-af335c6dd036",
          "collection_secret": "1CFA3C01-XXXX-XXXX-XXXX-3EBC44AB474F",
          "number_of_instances": 1
        },
        {
          "collection_id": "839feaf3-XXXX-XXXX-XXXX-c037ba3e791f",
          "collection_secret": "7EAA6B0C-XXXX-XXXX-XXXX-4ADC4F9941A0",
          "number_of_instances": 3
        }
      ]
    default: []
    required: false
    display:
      group: xmpro
      index: 1010

  artifacts_urls:
    type: string
    hidden: true
    display_label: Artifacts URLs
    description: >
      URLs of all artifacts for internet_connected and airgapped
      installation.
    default:
      ms_dotnet_core_hosting_bundle: *ms_dotnet_core_hosting_bundle_url

  ms_dotnet_core_hosting_bundle_filename:
    type: string
    hidden: true
    display_label: ASP.NET Core Runtime 6.0 Hosting Bundle Installer File Name
    description: >
      Microsoft ASP .NET Core Runtime 6.0 Hosting Bundle Installer File Name
    default: *ms_dotnet_core_hosting_bundle_filename

  ms_dotnet_core_hosting_bundle_url:
    type: string
    hidden: true
    display_label: ASP.NET Core Runtime 6.0 Hosting Bundle Installer URL
    description: >
      Microsoft ASP .NET Core Runtime 6.0 Hosting Bundle Installer URL
    default:
      get_input:
        - artifacts_urls
        - ms_dotnet_core_hosting_bundle
        - { get_input: environment_type }

  onprem_windows_services_zip_filename:
    type: string
    hidden: true
    display_label: XMPro Stream Host Onprem Windows Services File Name
    description: XMPro Stream Host Onprem windows services file name
    default: *onprem_windows_services_zip_filename

data_types:

  dell.types.XMPro.NonDefaultCollectionInstance:
    properties:
      collection_id:
        type: string
        required: true
      collection_secret:
        type: string
        required: true
      number_of_instances:
        type: integer
        required: true
