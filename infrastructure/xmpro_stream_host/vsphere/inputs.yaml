inputs:

  vm_template:
    type: string
    hidden: false
    allow_update: false
    display_label: Template Name
    description: |
      Name of the Virtual Machine Template in vSphere.
      Cannot contain leading or trailing spaces.
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: Cannot contain leading or trailing spaces.
    display:
      group: vsphere
      index: 1

  hostname:
    type: string
    hidden: false
    allow_update: false
    display_label: Hostname
    description: |
      Hostname of the Virtual Machine
      (an auto-generated suffix will also be added).
      Cannot contain characters other than:
      letters (a-z, A-Z), numbers (0-9), or hyphens (-).
      Can be up to 63 characters long.
    constraints:
    - pattern: ^(?!-)[a-zA-Z0-9-]{1,63}(?<!-)$
      error_message: |
        Must be letters (a-z, A-Z), numbers (0-9), or hyphens (-).
        No more than 64 characters.
    - max_length: 64
    default: XMProSH
    display:
      group: vsphere
      index: 3

  vm_user_name:
    type: string
    hidden: false
    allow_update: false
    display_label: Deployment User
    description: |
      Name of deployment user in the Virtual Machine template in vSphere.
      Cannot contain leading or trailing spaces.
    default: Administrator
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: Cannot contain leading or trailing spaces.
    display:
      group: vsphere
      index: 5

  vm_password_secret_name:
    type: secret_key
    hidden: false
    allow_update: false
    display_label: Virtual Machine Password Secret Name
    description: |
      Secret name containing the user password for
      the Windows Virtual Machine.
    constraints:
    - type: password
    display:
      group: vsphere
      index: 7

  allowed_esxi_host:
    type: list
    item_type: string
    hidden: false
    allow_update: false
    display_label: ESXi Hostnames
    description: |
      Names of the ESXi hosts on which the Virtual Machine should be placed.
      Mandatory for USB passthrough.
      Example: [node--01.example.local, node--02.example.local]
    display:
      group: vsphere
      index: 10
    required: false
    default: []

  datastore_name:
    type: string
    hidden: false
    allow_update: false
    display_label: Datastore
    description: |
      Name of the Datastore to use with the Virtual Machine.
      Cannot contain leading or trailing spaces.
      Example: VxRail-Virtual-SAN-Datastore-123abc
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: |
        Cannot contain leading or trailing spaces.
        Example: VxRail-Virtual-SAN-Datastore-123abc
    display:
      group: vsphere
      index: 15

  resource_pool_name:
    type: string
    hidden: false
    allow_update: false
    display_label: Resource Pool
    description: Name of the Resource Pool in vSphere.
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: Cannot contain leading or trailing spaces.
    display:
      group: vsphere
      index: 20

  vm_folder:
    type: string
    hidden: false
    allow_update: false
    display_label: VM Folder
    description: |
      Name of the folder in vSphere to deploy a Virtual Machine in to.
      Cannot contain leading or trailing spaces.
    constraints:
    - pattern: ^(?!\s)(?!.*\s$).*$
      error_message: Cannot contain leading or trailing spaces.
    display:
      group: vsphere
      index: 25

  vcpus:
    type: integer
    hidden: false
    allow_update: true
    display_label: vCPUs
    description: |
      Number of virtual CPUs allocated to the Virtual Machine.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 4
    constraints:
    - greater_or_equal: 2
    display:
      group: vsphere
      index: 28

  memory_size:
    type: integer
    hidden: false
    allow_update: true
    display_label: Memory Size
    description: |
      Memory (in MB) allocated to the Virtual Machine.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 16384
    constraints:
    - greater_or_equal: 8192
    display:
      group: vsphere
      index: 30

  os_disk_size:
    type: integer
    hidden: false
    allow_update: true
    display_label: OS Disk Size
    description: |
      Main OS disk size in GB.
      See https://documentation.xmpro.com/resources/sizing-guideline
      for recommendations.
    default: 50
    constraints:
    - greater_or_equal: 30
    display:
      group: vsphere
      index: 35

  disk_provisioning:
    type: string
    hidden: false
    allow_update: false
    display_label: Disk Provisioning Type
    description: OS Disk provisioning type for Virtual Machine in vSphere.
    default: thin
    constraints:
    - valid_values:
      - thickLazyZeroed
      - thickEagerZeroed
      - thin
    display:
      group: vsphere
      index: 40

  storage_disk_size:
    type: integer
    hidden: true
    allow_update: false
    display_label: Storage Disk Size [GB]
    description: Additional disks size in GB.
    default: 0

  disks_count:
    type: integer
    hidden: true
    allow_update: false
    display_label: Storage Disks Count
    description: Number of additional disks attached to the Virtual Machine.
    default: 0
    constraints:
    - in_range:
      - 0
      - 1

  storage_disk_provisioning:
    type: string
    hidden: true
    allow_update: false
    display_label: Storage Disk Provisioning Type
    description: Storage Disk provisioning type for Virtual Machine in vSphere.
    default: thin
    constraints:
    - valid_values:
      - thick
      - thin

  network_mappings:
    type: dell.datatypes.vsphere.NetworkMappings
    hidden: true
    allow_update: false
    display_label: Network Mappings
    description: |
      Array of key-value details for the OVF network setup.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: true
    display:
      group: network
      index: 7
    default:
      dns_servers:
        get_input: dns
      connect_networks:
      - name:
          get_input:
          - network
          - name
        switch_distributed:
          get_input:
          - network
          - switch_distributed
        management:
          get_input:
          - network
          - management
        external:
          get_input:
          - network
          - external
        use_dhcp:
          get_input: dhcp
        network:
          get_input: cidr
        gateway:
          get_input: gateway
        ip:
          get_input: static_ip

  network:
    type: dell.datatypes.vsphere.Network
    hidden: false
    allow_update: false
    display_label: Network Details
    description: |
      Which network to deploy the Virtual Machine on.
    display:
      group: vsphere
      index: 45

  cidr:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Network CIDR
    description: |
      Network subnet range in form of NETWORK_IP/NETMASK_PREFIX
      Example: 172.16.0.0/21
    required: true
    constraints:
    - pattern: ^(?:((25[0-5]|2[0-4]\d|1\d\d|\d{1,2})(\.(25[0-5]|2[0-4]\d|1\d\d|\d{1,2})){3})\/(3[0-2]|[12]?\d)|)$
      error_message: |
        Invalid format for IP Address in CIDR format.
        Example: 172.16.0.0/16
    display:
      group: vsphere
      index: 53

  dhcp:
    type: boolean
    hidden: false
    allow_update: false
    display_label: DHCP
    description: |
      Enable to allow IP configuration to be taken from DHCP
      instead of static IP settings.
    default: true
    display:
      group: vsphere
      index: 50

  gateway:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Gateway IP
    description: |
      IP address. Example: 172.16.0.1.
      Only required for static IP deployments, not for DHCP.
    required: true
    display:
      group: vsphere
      index: 55
    constraints:
    - pattern: ^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$|^$
      error_message: |
        Invalid format for IP Address.
        Example: 172.16.0.1

  dns:
    type: list
    item_type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: DNS Servers
    description: 'List of IP addresses. Example: ["1.1.1.1", "8.8.8.8"]'
    required: true
    display:
      group: vsphere
      index: 60
    default: []

  static_ip:
    type: string
    hidden: false
    exclusive_with: dhcp
    allow_update: false
    display_label: Static IP
    description: |
      IP address. Example: 172.16.0.1.
      Only required for static IP deployments, not for DHCP.
    required: true
    display:
      group: vsphere
      index: 65
    constraints:
    - pattern: ^(?:((25[0-5]|2[0-4]\d|1\d\d|\d{1,2})(\.(25[0-5]|2[0-4]\d|1\d\d|\d{1,2})){3}))$
      error_message: |
        Invalid format for IP Address.
        Example: 172.16.0.1

  pci_devices:
    type: list
    item_type: dell.datatypes.vsphere.PCIDevice
    hidden: true
    allow_update: false
    display_label: PCI Devices
    description: |
      List of PCI Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  usb_devices:
    type: list
    item_type: dell.datatypes.vsphere.USBDevice
    hidden: true
    allow_update: false
    display_label: USB Devices
    description: |
      List of USB Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  serial_ports:
    type: list
    item_type: dell.datatypes.vsphere.SerialPort
    hidden: true
    allow_update: false
    display_label: Serial Ports
    description: |
      A list of serial ports to pass through to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    required: false
    default: []

  nics_device_list:
    type: list
    item_type: dell.datatypes.vsphere.NIC
    hidden: true
    allow_update: false
    display_label: NICs Devices
    description: |
      List of NIC Devices that will be created and attached
      to the Virtual Machine.
      See blueprint documentation for more details on the correct
      formatting for this option.
    default: []

data_types:

  dell.datatypes.vsphere.USBDevice:
    properties:
      device_name:
        type: string
        description: Host USB Device Name
        required: true
      controller_type:
        type: string
        description: |
          USB Controller type associated with USB.
          Values can be: usb2, usb3
        required: false
        default: usb3

  dell.datatypes.vsphere.SerialPort:
    properties:
      device_name:
        type: string
        description: |
          Host Serial Port Name.
          Should be an absolute path: /dev/char/serial/uartX
        required: true

  dell.datatypes.vsphere.PCIDevice:
    properties:
      device_name:
        type: string
        description: PCI Passthrough Device Name
        required: true

  dell.datatypes.vsphere.NIC:
    properties:
      network_name:
        type: string
        description: |
          Name of the network to be connected.
      external_network_distributed:
        type: boolean
        description: |
          Determines if this is connected to a distributed port group.
        default: false
      adapter_type:
        type: string
        description: |
          Type of the adapter. Possible values: Vmxnet3, Vmxnet2, Sriov, E1000, E1000e
        default: Vmxnet3
      network_management:
        type: boolean
        description: |
          Determines if this is a management network.
        default: true
      external_network:
        type: boolean
        description: |
          Determines if this is an external network.
        default: true
      dhcp_network:
        type: boolean
        description: |
          Determines if IP address should be fetched from DHCP server.
        default: false
      network_cidr:
        type: string
        description: |
          Address of the network in CIDR format e.g. 192.168.0.1/24
        default: ''
        required: false
      gateway:
        type: string
        description: |
          IP address of the default gateway.
        required: false
      ip:
        type: string
        description: |
          Static IP address to be set for this network interface.
        required: false

  dell.datatypes.vsphere.NetworkMappings:
    properties:
      domain:
        type: string
        description: |
          Name of the domain.
        required: false
      dns_servers:
        type: list
        description: |
          List of DNS servers.
        required: false
      connect_networks:
        type: list
        description: |
          List of networks to be connected.
        required: false

  dell.datatypes.vsphere.ConnectNetwork:
    properties:
      name:
        type: string
        description: |
          Name of the network to be connected.
      switch_distributed:
        type: boolean
        description: |
          Determines if this is connected to a distributed port group.
        default: false
      management:
        type: boolean
        description: |
          Determines if this is a management network.
        default: false
      external:
        type: boolean
        description: |
          Determines if this is an external network.
        default: false
      nsx_t_switch:
        type: boolean
        description: |
          Determines if this is connected to a NSX-T Logical Switch.
        default: false
      use_dhcp:
        type: boolean
        description: |
          Determines if IP address should be fetched from DHCP server.
        default: true
      network:
        type: string
        description: |
          Address of the network in CIDR format e.g. 192.168.0.1/24
        default: ''
        required: false
      gateway:
        type: string
        description: |
          IP address of the default gateway.
        required: false
      ip:
        type: string
        description: |
          Static IP address to be set for this network interface.
        required: false

  dell.datatypes.vsphere.Network:
    description: |
      Environment-agnostic network schema.
      Supports: vSphere, but also NativeEdge Endpoints
    properties:
      name:
        type: string
        description: |
          The name of the network.
        required: true
      switch_distributed:
        type: boolean
        description: |
          Determines if this is connected to a distributed port group.
        required: false
        default: true
      management:
        type: boolean
        description: |
          Determines if this is a management network interface.
        required: false
        default: true
      external:
        type: boolean
        description: |
          Determines if this is a external network interface.
        required: false
        default: true
